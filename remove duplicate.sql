use sql_practice;
create table if not exists cars
(
    id      int,
    model   varchar(50),
    brand   varchar(40),
    color   varchar(30),
    make    int
);
insert into cars values (1, 'Model S', 'Tesla', 'Blue', 2018);
insert into cars values (2, 'EQS', 'Mercedes-Benz', 'Black', 2022);
insert into cars values (3, 'iX', 'BMW', 'Red', 2022);
insert into cars values (4, 'Ioniq 5', 'Hyundai', 'White', 2021);
insert into cars values (5, 'Model S', 'Tesla', 'Silver', 2018);
insert into cars values (6, 'Ioniq 5', 'Hyundai', 'Green', 2021);

## solution 1 using group by

DELETE FROM cars
WHERE id IN (
    SELECT id
    FROM (
        SELECT MAX(id) AS id
        FROM cars
        GROUP BY model, brand
        HAVING COUNT(*) > 1
    ) AS temp_table
);

## solution 2  using self join
SELECT  * FROM  cars;


DELETE FROM cars
WHERE id IN (
    SELECT id
    FROM (
        SELECT a.id
        FROM cars AS a
        JOIN cars AS b
        ON a.model = b.model AND a.brand = b.brand
        WHERE b.id < a.id
    ) AS temp_table
);

#OR 
WITH temp_table as (
        SELECT a.id
        FROM cars AS a
        JOIN cars AS b
        ON a.model = b.model AND a.brand = b.brand
        WHERE b.id < a.id)
        delete from cars where id in(select id from temp_table) ;
        
        
        
#solution 3 using window function tion

DELETE  FROM cars 
WHERE id IN (SELECT id FROM 
(SELECT *, ROW_NUMBER() OVER(PARTITION BY model,brand) AS rn FROM cars) 
AS d  WHERE rn > 1);
        
#  solution 4 using min dunction  with multiple record
DELETE  FROM cars 
WHERE id NOT IN
(SELECT id FROM 
(SELECT  min(id) AS id FROM cars GROUP BY  model,brand) 
AS temp_temple);


# solution 5 using back up table without dropping original table

CREATE TABLE  cars_bkp
SELECT * FROM  cars WHERE 1 = 2;    #create empty table


INSERT INTO cars_bkp
SELECT *
FROM cars
WHERE id IN (
    SELECT MIN(id)
    FROM cars
    GROUP BY model, brand
);

TRUNCATE TABLE cars;

INSERT INTO cars
SELECT * FROM cars_bkp;












































































































































































































































































































































































































































































































































































































































































































